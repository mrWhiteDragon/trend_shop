{% extends 'core/base.html' %}
{% load static %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ | –¢—Ä–µ–Ω–¥{% endblock %}

{% block content %}
<div class="container">

    <form class="d-flex mt-4" action="{% url 'product_list' %}" method="get">
        <input class="form-control search-box me-2" type="search" name="q"
               placeholder="üîç –ù–∞–π—Ç–∏ –≥–∞–¥–∂–µ—Ç—ã, –∫—Ä–æ—Å—Å–æ–≤–∫–∏, –∫–æ—Å–º–µ—Ç–∏–∫—É..."
               value="{{ search_query|default:'' }}">
        <button class="btn btn-primary search-btn" type="submit">
            <span class="d-none d-sm-inline">–ü–æ–∏—Å–∫</span>
            <span class="d-inline d-sm-none"><i class="bi bi-search"></i></span>
        </button>
    </form>

    <div class="container-fluid py-4">
        <div class="row">
            <!-- –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –Ω–∞ —ç–∫—Ä–∞–Ω–∞—Ö –º–µ–Ω—å—à–µ md) -->
            <div class="d-md-none mb-3">
                <button class="btn btn-outline-primary w-100" type="button" data-bs-toggle="collapse" data-bs-target="#categoriesCollapse">
                    <i class="bi bi-filter-left me-2"></i> –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                </button>
            </div>

            <!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="col-lg-3 col-md-4 mb-4">
                <div class="card border-0 shadow-sm collapse d-md-block" id="categoriesCollapse">
                    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ (—Å–∫—Ä—ã—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö) -->
                    <div class="card-header bg-primary text-white py-3 d-none d-md-block">
                        <h5 class="mb-0"><i class="bi bi-list-ul me-2"></i>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h5>
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <a href="{% url 'product_list' %}" class="list-group-item list-group-item-action {% if not category %}active bg-light{% endif %} border-0 text-dark">
                                –í—Å–µ —Ç–æ–≤–∞—Ä—ã
                            </a>
                            {% for c in categories %}
                            <a href="{{ c.get_absolute_url }}"
                               class="list-group-item list-group-item-action {% if category and category.id == c.id %}active bg-light{% endif %} border-0 text-dark">
                                {{ c.name }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
            <div class="col-lg-9 col-md-8">

                {% if search_query %}
                <div class="mb-4">
                    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥–ª—è "{{ search_query }}"</h4>
                    <p class="text-muted">–ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {{ products.count }}</p>
                </div>
                {% endif %}

                <div class="row g-4">
                    {% for product in products %}
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card h-100 border-0 shadow-sm hover-effect">
                            <!-- –ü–ª–∞—à–∫–∞ "–ê–∫—Ü–∏—è" -->
                            {% if product.is_featured %}
                            <span class="badge bg-danger position-absolute top-0 end-0 m-2" style="z-index: 10;">
                                <i class="bi bi-percent"></i> –ê–∫—Ü–∏—è
                            </span>
                            {% endif %}

                            <!-- –ö–≤–∞–¥—Ä–∞—Ç–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ 1:1 -->
                            <a href="{{ product.get_absolute_url }}">
                                <div class="ratio ratio-1x1 bg-light">
                                    <img src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'img/no_image.png' %}{% endif %}"
                                         class="card-img-top p-3 object-fit-contain"
                                         alt="{{ product.name }}">
                                </div>
                            </a>

                            <div class="card-body d-flex flex-column pb-0">
                                <h5 class="card-title">
                                    <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                                        {{ product.name }}
                                    </a>
                                </h5>

                                <!-- –ë–ª–æ–∫ —Å —Ü–µ–Ω–∞–º–∏ -->
                                <div class="mt-auto mb-3">
                                    {% if product.old_price %}
                                    <p class="text-danger mb-1">
                                        <del>{{ product.old_price|floatformat:2 }} —Ä—É–±.</del>
                                    </p>
                                    {% endif %}
                                    <h5 class="text-primary mb-0">{{ product.price|floatformat:2 }} —Ä—É–±.</h5>
                                </div>
                            </div>

                            <!-- –ö–Ω–æ–ø–∫–∞ "–í –∫–æ—Ä–∑–∏–Ω—É" -->
                            <div class="card-footer bg-white border-0 pt-0 pb-3">
                                <form action="{% url 'cart:add_to_cart' product.id %}" method="post">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-primary w-100 py-2">
                                        <i class="bi bi-cart3 me-2"></i>–í –∫–æ—Ä–∑–∏–Ω—É
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-12">
                        <div class="alert alert-info shadow-sm">
                            <i class="bi bi-info-circle me-2"></i>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}